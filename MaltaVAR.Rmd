---
title: "MaltaVAR"
author: "Georges Ip" 
date: "5/28/2019"
output: html_document
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library("fImport")
library(fOptions)
#library(RQuantLib)
library(nlstools)
library(tseries)
library(Quandl)
library(zoo)
library(PerformanceAnalytics)
library(quantmod)
library(car)
library(FinTS)
library(fOptions)
library(forecast)
require(stats)
library(vars)
library(tseries, quietly = T)
library(forecast, quietly = T)
library(XML)
library(fBasics)
library(timsac)
library(TTR)
library(lattice)
library(foreign)
library(MASS)
require(stats4)
library(KernSmooth)
library(fastICA)
library(cluster)
library(leaps)
library(mgcv)
library(rpart)
require("datasets")
require(graphics)
library(RColorBrewer)
library(dynlm)
library(tidyverse)
library(readxl)
library(lubridate)
library(fpp2)
library(seasonal)
library(strucchange)
library(astsa)
library(vars)
library(lmtest)
library(dlnm)
```


(a) Produce a time-series plot of your data including the respective ACF and PACF plots.
```{r message=FALSE, warning=FALSE}
MaltaHPI <- read.csv("MaltaHPI.csv")
EUGDP <- read.csv("CPMNACSCAB1GQEU28.csv")
names(MaltaHPI) <- c("Time", "HPI")
names(EUGDP) <- c("Time", "EUGDP")

#subset data to remove bottom rows
MaltaHPI <- MaltaHPI[-c(57:60),]

#Convert to numeric
MaltaHPI <- transform(MaltaHPI, HPI = as.numeric(HPI))
HPIts <- ts(MaltaHPI$HPI, start=c(2005,1),freq=4)
EUGDPts <- ts(EUGDP$EUGDP, start=c(2005,1),freq=4)
z=cbind(HPIts,EUGDPts)
VARm=data.frame(z)
```

<h3>Malta HPI Dataset Analysis</h3>

(a) Plot of time series, ACF, PACF

```{r message=FALSE, warning=FALSE}
  tsdisplay(HPIts)
```
<br> Analysis of the correlograms suggests that the series follows an AR-1 process 


(b) Model fit (trend, seasonality, cycle) and discussion 
```{r,}
stlHPI=stl(HPIts,s.window = "periodic")
plot(stlHPI,main="STL Decomposition of HPIts")
#q=decompose(HPIts, type = "multiplicative", filter = NULL)
#plot(q)

#ARMA component 
m1<-Arima(HPIts,order=c(1,0,0),seasonal = c(1,0,0), include.drift = TRUE)
plot(HPIts,main="AR1 with SAR1 model with Drift")
lines(m1$fitted,col='red')
legend(2006,110,legend=c("Observed","Estimated"),col=c("black","red"))
Box.test(m1$residuals)
```
The model includes both a seasonal AR-1 and a regular AR-1 component with a drift, which captures the linear component of the data, thereby satisfying the conditions for a model that includes a linear, seasonal, and cyclical component. The residuals satisfy the conditions of a white noise series, suggesting that the model is robust. 

(c) Residuals vs. Fitted values and discussion

```{r message=FALSE, warning=FALSE}
  plot(m1$fitted,m1$residuals,main="Residuals vs Fitted")
```

(d) ACF/PACF analysis for residuals.
```{r,}
tsdisplay(m1$residuals,main="Residual Analysis")
```

Multiplicative Decomposition has less significant lags than STL.

(e) CUSUM interpretation
```{r,}
plot(cumsum(stlHPI$time.series[,3]))
plot(cumsum(q$random[3:52]))
```

(f) Recursive Residual Analysis
(g) Diagnostic Statistics
(h) 12-step ahead forecast


<h3>EU GDP Analysis</h3>
###(a) Plot of time series, ACF, PACF
```{r}
tsdisplay(EUGDPts)
```
The plot of the data shows that the mean appears to increase over time, however, volatility seems relatively low. The ACF decays relatively quickly to 0, while the PACF only shows a significant spike at a lag of 1. This could be indicative of an AR(1) process.

(b) Model fit and discussion
```{r}
mEU1 <- Arima(EUGDPts, order = c(1,0,0))
#alternative models
mEU2 <- Arima(EUGDPts, order = c(1,1,0))
mEU3 <- Arima(EUGDPts, order = c(1,1,0), seasonal = c(1,0,0))
#Look at model selection criteria
AIC(mEU1,mEU2,mEU3)
BIC(mEU1,mEU2,mEU3)
```
AIC and BIC both agree that mEU2 is the best model. Hence, we propose an arima(1,1,0) model for EUGDP, we eliminate the seasonal component.. 

(c) Residuals vs. Fitted values and discussion
```{r}

```

(d) ACF/PACF analysis for residuals.
```{r}
tsdisplay(mEU2$residuals)
```

There are no significant lags in the ACF or PACF which suggest we have chosen a good model.

(e) CUSUM interpretation
```{r,}
plot(cumsum(mEU2$residuals))
```
(f) Recursive Residual Analysis
(g) Diagnostic Statistics
(h) 12-step ahead forecast

<h3> VAR modeling, forecasting, and causality analysis </h3>
(i) VAR Model and plot discussion
```{r,}
VAR1=VAR(VARm,p=3)
summary(VAR1)
```

(j) Impulse Response Interpretation
```{r,}
plot(irf(VAR1, n.ahead=30))
```

(k) Granger Causality Analysis
```{r,}
grangertest(HPIts ~ EUGDPts, order = 8)
grangertest(EUGDPts ~ HPIts, order = 8)
```

(l) VAR Model 12 step ahead forecast, comparrison with univariate models 

